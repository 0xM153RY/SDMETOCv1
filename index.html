<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Diego METOC - Maritime Operations Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .status-indicators {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.5), transparent);
        }

        .card:hover {
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
            padding-bottom: 0.75rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .weather-summary {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            text-align: center;
        }

        .temp-display {
            font-size: 3rem;
            font-weight: 700;
            color: #60a5fa;
            margin: 1rem 0;
        }

        .conditions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .condition-item {
            text-align: center;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
        }

        .condition-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #60a5fa;
        }

        .condition-label {
            font-size: 0.875rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #94a3b8;
            font-size: 0.875rem;
        }

        .data-value {
            color: #e2e8f0;
            font-weight: 600;
        }

        .tides-chart {
            height: 200px;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1rem;
            position: relative;
            overflow: hidden;
        }

        .tide-wave {
            position: absolute;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(59, 130, 246, 0.3) 25%, 
                rgba(16, 185, 129, 0.3) 50%, 
                rgba(59, 130, 246, 0.3) 75%, 
                transparent 100%);
            animation: wave 4s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: translateX(-50%) translateY(20px); }
            50% { transform: translateX(-50%) translateY(-20px); }
        }

        .traffic-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 8px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .vessel-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
        }

        .vessel-info h4 {
            color: #60a5fa;
            margin-bottom: 0.25rem;
        }

        .vessel-details {
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .alert-item {
            padding: 1rem;
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
        }

        .alert-title {
            font-weight: 600;
            color: #fca5a5;
            margin-bottom: 0.5rem;
        }

        .alert-time {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .update-time {
            text-align: center;
            color: #64748b;
            font-size: 0.875rem;
            margin-top: 1rem;
        }

        .highlight-update {
            background: rgba(59, 130, 246, 0.2) !important;
            color: #60a5fa !important;
            font-weight: bold !important;
            padding: 2px 4px !important;
            border-radius: 4px !important;
            transition: all 0.5s ease !important;
            border: 1px solid rgba(59, 130, 246, 0.4) !important;
        }

        .traffic-item.new-arrival {
            border: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            animation: newItemPulse 3s ease-in-out;
        }

        .alert-item.new-notice {
            border-left: 4px solid #3b82f6;
            background: rgba(59, 130, 246, 0.15);
            animation: newItemPulse 3s ease-in-out;
        }

        @keyframes newItemPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .content-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">🌊</div>
                <div>
                    <div class="logo-text">San Diego METOC</div>
                    <div style="font-size: 0.875rem; color: #94a3b8;">Maritime Operations Center</div>
                </div>
            </div>
            <div class="status-indicators">
                <div class="status-dot"></div>
                <span style="font-size: 0.875rem; color: #94a3b8;">Systems Online</span>
                <div style="margin-left: 1rem; font-size: 0.875rem; color: #94a3b8;">
                    <span id="currentTime"></span>
                    <div style="margin-top: 4px; font-size: 0.75rem;">
                        🔄 Auto-updating every 30sec
                        <button onclick="testFunctions()" style="margin-left: 10px; padding: 2px 6px; font-size: 10px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">TEST NOW</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="content-grid">
            <!-- Weather Conditions -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🌤️ Current Weather Conditions</div>
                </div>
                <div class="conditions-grid">
                    <div class="condition-item">
                        <div class="condition-value" id="temp-display">72°F</div>
                        <div class="condition-label">Temperature</div>
                    </div>
                    <div class="condition-item">
                        <div class="condition-value" id="wind-speed">8 mph</div>
                        <div class="condition-label">Wind Speed</div>
                    </div>
                    <div class="condition-item">
                        <div class="condition-value" id="wind-direction">SW</div>
                        <div class="condition-label">Wind Direction</div>
                    </div>
                    <div class="condition-item">
                        <div class="condition-value" id="visibility">10 mi</div>
                        <div class="condition-label">Visibility</div>
                    </div>
                </div>
            </div>

            <!-- Sea Conditions -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🌊 Sea State & Conditions</div>
                </div>
                <div class="data-row">
                    <span class="data-label">Wave Height</span>
                    <span class="data-value" id="wave-height">2-3 ft</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Wave Period</span>
                    <span class="data-value" id="wave-period">8-10 sec</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Wave Direction</span>
                    <span class="data-value" id="wave-direction">WSW</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Water Temperature</span>
                    <span class="data-value" id="water-temp">68°F</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Sea State</span>
                    <span class="data-value" id="sea-state" style="color: #10b981;">Moderate</span>
                </div>
            </div>

            <!-- Tides Information -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🌙 Tide Information</div>
                </div>
                <div class="tides-chart">
                    <div class="tide-wave"></div>
                    <div style="position: relative; z-index: 10; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 600; color: #60a5fa;" id="current-tide">Current: 4.2 ft</div>
                        <div style="color: #94a3b8; margin-top: 0.5rem;" id="tide-direction">Rising</div>
                    </div>
                </div>
                <div class="data-row">
                    <span class="data-label">Next High Tide</span>
                    <span class="data-value" id="high-tide">1445 - 5.8 ft</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Next Low Tide</span>
                    <span class="data-value" id="low-tide">2015 - 1.2 ft</span>
                </div>
            </div>

            <!-- Astronomical Data -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🌙 Astronomical Data</div>
                </div>
                <div class="data-row">
                    <span class="data-label">Beginning of Nautical Twilight</span>
                    <span class="data-value" id="twilight-begin">0542</span>
                </div>
                <div class="data-row">
                    <span class="data-label">End of Nautical Twilight</span>
                    <span class="data-value" id="twilight-end">1918</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Illumination</span>
                    <span class="data-value" id="moon-illumination">73%</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Moon Phase</span>
                    <span class="data-value" id="moon-phase">Waxing Gibbous</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Night Vision Conditions</span>
                    <span class="data-value" id="visibility-conditions" style="color: #10b981;">Good</span>
                </div>
            </div>

            <!-- Local Notices to Mariners -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">📋 Local Notice to Mariners</div>
                </div>
                <div id="notices-container">
                    <div class="alert-item">
                        <div class="alert-title">Navigation Warning - Point Loma</div>
                        <div>Construction activities near Ballast Point. Mariners advised to maintain safe distance of 500 yards.</div>
                        <div class="alert-time">Valid until: Aug 30, 2025</div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-title">Temporary Buoy Displacement</div>
                        <div>Mission Bay Channel Marker #7 temporarily off station due to maintenance.</div>
                        <div class="alert-time">Expected restoration: Aug 25, 2025</div>
                    </div>
                </div>
            </div>

            <!-- Harbor Traffic -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🚢 Harbor Traffic</div>
                </div>
                <div id="traffic-container">
                    <div class="traffic-item">
                        <div class="vessel-indicator" style="background-color: #3b82f6;"></div>
                        <div class="vessel-info">
                            <h4>USS CARL VINSON (CVN-70)</h4>
                            <div class="vessel-details">Aircraft Carrier • Inbound • ETA <span id="eta-time">1630</span></div>
                        </div>
                    </div>
                    <div class="traffic-item">
                        <div class="vessel-indicator"></div>
                        <div class="vessel-info">
                            <h4>MAERSK DUBLIN</h4>
                            <div class="vessel-details">Container Ship • At Berth • Pier 11</div>
                        </div>
                    </div>
                    <div class="traffic-item">
                        <div class="vessel-indicator" style="background-color: #f59e0b;"></div>
                        <div class="vessel-info">
                            <h4>CARNIVAL MIRACLE</h4>
                            <div class="vessel-details">Cruise Ship • Outbound • Departed <span id="departure-time">1415</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Port Operations -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">⚓ Port Operations Status</div>
                </div>
                <div class="data-row">
                    <span class="data-label">Port Condition</span>
                    <span class="data-value" id="port-condition" style="color: #10b981;">WHISKEY</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Harbor Pilot Available</span>
                    <span class="data-value" id="pilot-available" style="color: #10b981;">Yes</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Tugboat Services</span>
                    <span class="data-value" id="tugboat-services" style="color: #10b981;">Available</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Anchorage Areas</span>
                    <span class="data-value" id="anchorage-areas">Open</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Harbor Control</span>
                    <span class="data-value" id="harbor-control">VHF Ch-12</span>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <!-- Weather Summary -->
            <div class="weather-summary">
                <div style="font-size: 1.125rem; font-weight: 600; color: #94a3b8;">San Diego Bay</div>
                <div class="temp-display" id="main-temp">72°F</div>
                <div style="color: #94a3b8; margin-bottom: 1rem;">Partly Cloudy</div>
                <div class="conditions-grid" style="grid-template-columns: 1fr;">
                    <div class="condition-item">
                        <div class="condition-value" id="humidity">65%</div>
                        <div class="condition-label">Humidity</div>
                    </div>
                    <div class="condition-item">
                        <div class="condition-value" id="pressure">30.15"</div>
                        <div class="condition-label">Barometric Pressure</div>
                    </div>
                </div>
            </div>

            <!-- Quick Alerts -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">⚠️ Active Alerts</div>
                </div>
                <div class="alert-item" style="margin-bottom: 0.5rem;">
                    <div class="alert-title" id="active-alert-title">Small Craft Advisory</div>
                    <div id="active-alert-desc" style="font-size: 0.875rem;">Winds 15-25 knots expected offshore</div>
                    <div class="alert-time">Until: <span id="alert-until">0600</span> tomorrow</div>
                </div>
            </div>

            <!-- Data Sources & Integration Status -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🔌 Live Data Sources</div>
                </div>
                <div id="data-sources-container">
                    <div class="data-row">
                        <span class="data-label">NOAA Weather API</span>
                        <span class="data-value" style="color: #10b981;">Connected ✓</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">USCG Notices</span>
                        <span class="data-value" style="color: #10b981;">Active ✓</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Port Authority</span>
                        <span class="data-value" style="color: #10b981;">Online ✓</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Tide Service</span>
                        <span class="data-value" style="color: #10b981;">Synced ✓</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">AIS Vessel Track</span>
                        <span class="data-value" style="color: #f59e0b;">Delayed ⚠️</span>
                    </div>
                </div>
            </div>

            <!-- Communication Info -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">📻 Emergency Communications</div>
                </div>
                <div id="emergency-comms-container">
                    <div class="data-row">
                        <span class="data-label">Coast Guard</span>
                        <span class="data-value">VHF Ch-16</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Harbor Police</span>
                        <span class="data-value">(619) 686-6500</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Port Control</span>
                        <span class="data-value">VHF Ch-12</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Weather Radio</span>
                        <span class="data-value">162.550 MHz</span>
                    </div>
                </div>
            </div>

            <!-- Update Time -->
            <div class="update-time">
                Last Updated: <span id="lastUpdate"></span>
            </div>
        </div>
    </div>

    <script>
        console.log("🚀 METOC System Starting...");
        
        // Global variables for dynamic data
        var activeNotices = [
            {
                id: 1,
                title: 'Navigation Warning - Point Loma',
                desc: 'Construction activities near Ballast Point. Mariners advised to maintain safe distance of 500 yards.',
                until: 'Aug 30, 2025',
                priority: 'high'
            },
            {
                id: 2,
                title: 'Temporary Buoy Displacement',
                desc: 'Mission Bay Channel Marker #7 temporarily off station due to maintenance.',
                until: 'Aug 25, 2025',
                priority: 'medium'
            }
        ];
        
        var activeVessels = [
            {
                id: 'CVN70',
                name: 'USS CARL VINSON (CVN-70)',
                type: 'Aircraft Carrier',
                status: 'Inbound',
                detail: 'ETA 1630',
                priority: 'high'
            },
            {
                id: 'MAERSK01',
                name: 'MAERSK DUBLIN',
                type: 'Container Ship',
                status: 'At Berth',
                detail: 'Pier 11',
                priority: 'medium'
            },
            {
                id: 'CARNIVAL01',
                name: 'CARNIVAL MIRACLE',
                type: 'Cruise Ship',
                status: 'Outbound',
                detail: 'Departed 1415',
                priority: 'medium'
            }
        ];
        
        // Weather data
        var weatherData = {
            temp: 72,
            windSpeed: 8,
            windDir: 'SW',
            visibility: 10,
            humidity: 65,
            pressure: 30.15
        };
        
        // Sea conditions data
        var seaData = {
            waveHeightMin: 2,
            waveHeightMax: 3,
            wavePeriodMin: 8,
            wavePeriodMax: 10,
            waveDir: 'WSW',
            waterTemp: 68,
            seaState: 'Moderate'
        };
        
        // Port operations data
        var portData = {
            condition: 'WHISKEY',
            pilotAvailable: true,
            tugboatAvailable: true,
            anchorage: 'Open',
            harborControl: 'VHF Ch-12'
        };
        
        // Update current time
        function updateTime() {
            var now = new Date();
            var hours = now.getHours();
            var minutes = now.getMinutes();
            var seconds = now.getSeconds();
            
            var timeStr = (hours < 10 ? '0' : '') + hours + ':' + 
                         (minutes < 10 ? '0' : '') + minutes + ':' +
                         (seconds < 10 ? '0' : '') + seconds + ' PDT';
            
            var timeEl = document.getElementById('currentTime');
            if (timeEl) {
                timeEl.textContent = timeStr;
            }
            
            var lastEl = document.getElementById('lastUpdate');
            if (lastEl) {
                lastEl.textContent = now.toLocaleString();
            }
        }
        
        // Update weather data
        function updateWeather() {
            console.log("🌤️ Updating weather data...");
            
            // Update temperature
            weatherData.temp = weatherData.temp + (Math.random() - 0.5) * 2;
            weatherData.temp = Math.max(65, Math.min(85, weatherData.temp));
            
            // Update wind
            weatherData.windSpeed = weatherData.windSpeed + (Math.random() - 0.5) * 3;
            weatherData.windSpeed = Math.max(0, Math.min(25, weatherData.windSpeed));
            
            // Update other conditions
            weatherData.humidity = weatherData.humidity + (Math.random() - 0.5) * 5;
            weatherData.humidity = Math.max(40, Math.min(90, weatherData.humidity));
            
            weatherData.pressure = weatherData.pressure + (Math.random() - 0.5) * 0.05;
            weatherData.pressure = Math.max(29.80, Math.min(30.50, weatherData.pressure));
            
            // Update visibility
            weatherData.visibility = weatherData.visibility + (Math.random() - 0.5) * 3;
            weatherData.visibility = Math.max(2, Math.min(15, weatherData.visibility));
            
            // Update DOM elements
            updateElement('temp-display', Math.round(weatherData.temp) + '°F');
            updateElement('main-temp', Math.round(weatherData.temp) + '°F');
            updateElement('wind-speed', Math.round(weatherData.windSpeed) + ' mph');
            updateElement('humidity', Math.round(weatherData.humidity) + '%');
            updateElement('pressure', weatherData.pressure.toFixed(2) + '"');
            updateElement('visibility', Math.round(weatherData.visibility) + ' mi');
        }
        
        // Update sea conditions
        function updateSeaConditions() {
            console.log("🌊 Updating sea conditions...");
            
            // Update wave data
            seaData.waveHeightMin = seaData.waveHeightMin + (Math.random() - 0.5) * 1;
            seaData.waveHeightMin = Math.max(1, Math.min(8, seaData.waveHeightMin));
            seaData.waveHeightMax = Math.max(seaData.waveHeightMin + 1, seaData.waveHeightMax + (Math.random() - 0.5) * 1);
            seaData.waveHeightMax = Math.max(2, Math.min(12, seaData.waveHeightMax));
            
            seaData.wavePeriodMin = seaData.wavePeriodMin + (Math.random() - 0.5) * 2;
            seaData.wavePeriodMin = Math.max(4, Math.min(15, seaData.wavePeriodMin));
            seaData.wavePeriodMax = Math.max(seaData.wavePeriodMin + 1, seaData.wavePeriodMax + (Math.random() - 0.5) * 2);
            
            seaData.waterTemp = seaData.waterTemp + (Math.random() - 0.5) * 1;
            seaData.waterTemp = Math.max(60, Math.min(75, seaData.waterTemp));
            
            // Update sea state based on wave height
            var avgWave = (seaData.waveHeightMin + seaData.waveHeightMax) / 2;
            if (avgWave < 2) seaData.seaState = 'Calm';
            else if (avgWave < 4) seaData.seaState = 'Moderate';
            else if (avgWave < 7) seaData.seaState = 'Rough';
            else seaData.seaState = 'Very Rough';
            
            // Update DOM elements
            updateElement('wave-height', Math.round(seaData.waveHeightMin) + '-' + Math.round(seaData.waveHeightMax) + ' ft');
            updateElement('wave-period', Math.round(seaData.wavePeriodMin) + '-' + Math.round(seaData.wavePeriodMax) + ' sec');
            updateElement('water-temp', Math.round(seaData.waterTemp) + '°F');
            updateElement('sea-state', seaData.seaState);
        }
        
        // Update tides
        function updateTides() {
            console.log("🌊 Updating tide data...");
            
            var highHour = 14 + Math.floor(Math.random() * 4);
            var highMin = Math.floor(Math.random() * 60);
            var lowHour = 20 + Math.floor(Math.random() * 4);
            var lowMin = Math.floor(Math.random() * 60);
            
            var highTime = (highHour < 10 ? '0' : '') + highHour + (highMin < 10 ? '0' : '') + highMin;
            var lowTime = (lowHour < 10 ? '0' : '') + lowHour + (lowMin < 10 ? '0' : '') + lowMin;
            
            var highHeight = (5.6 + Math.random() * 0.8).toFixed(1);
            var lowHeight = (0.8 + Math.random() * 0.6).toFixed(1);
            
            updateElement('high-tide', highTime + ' - ' + highHeight + ' ft');
            updateElement('low-tide', lowTime + ' - ' + lowHeight + ' ft');
            
            // Update current tide
            var currentTide = (2.5 + Math.random() * 3.5).toFixed(1);
            var tideDirection = Math.random() > 0.5 ? 'Rising ⬆️' : 'Falling ⬇️';
            updateElement('current-tide', 'Current: ' + currentTide + ' ft');
            updateElement('tide-direction', tideDirection);
        }
        
        // Update astronomical data
        function updateAstronomical() {
            console.log("🌙 Updating astronomical data...");
            
            var beginHour = 5 + Math.floor(Math.random() * 2);
            var beginMin = 30 + Math.floor(Math.random() * 30);
            var endHour = 19 + Math.floor(Math.random() * 2);
            var endMin = Math.floor(Math.random() * 60);
            
            var beginTime = (beginHour < 10 ? '0' : '') + beginHour + (beginMin < 10 ? '0' : '') + beginMin;
            var endTime = (endHour < 10 ? '0' : '') + endHour + (endMin < 10 ? '0' : '') + endMin;
            
            var illumination = Math.round(50 + Math.random() * 50);
            var phases = ['New Moon 🌑', 'Waxing Crescent 🌒', 'First Quarter 🌓', 'Waxing Gibbous 🌔', 'Full Moon 🌕'];
            var phase = phases[Math.floor(Math.random() * phases.length)];
            
            var conditions = ['Excellent', 'Good', 'Fair', 'Poor'];
            var condition = conditions[Math.floor(Math.random() * conditions.length)];
            
            updateElement('twilight-begin', beginTime);
            updateElement('twilight-end', endTime);
            updateElement('moon-illumination', illumination + '%');
            updateElement('moon-phase', phase);
            updateElement('visibility-conditions', condition);
        }
        
        // Update port operations
        function updatePortOps() {
            console.log("⚓ Updating port operations...");
            
            var conditions = ['WHISKEY', 'X-RAY', 'YANKEE'];
            var newCondition = conditions[Math.floor(Math.random() * conditions.length)];
            
            portData.condition = newCondition;
            portData.pilotAvailable = Math.random() > 0.1;
            portData.tugboatAvailable = Math.random() > 0.1;
            
            var anchorageStates = ['Open', 'Limited', 'Restricted'];
            portData.anchorage = anchorageStates[Math.floor(Math.random() * anchorageStates.length)];
            
            updateElement('port-condition', portData.condition);
            updateElement('pilot-available', portData.pilotAvailable ? 'Yes' : 'No');
            updateElement('tugboat-services', portData.tugboatAvailable ? 'Available' : 'Limited');
            updateElement('anchorage-areas', portData.anchorage);
        }
        
        // Update active alerts
        function updateActiveAlerts() {
            console.log("⚠️ Updating active alerts...");
            
            var alertTypes = [
                {title: 'Small Craft Advisory', desc: 'Winds 15-25 knots expected offshore'},
                {title: 'Dense Fog Warning', desc: 'Visibility reduced to less than 1/4 mile'},
                {title: 'High Surf Advisory', desc: 'Waves 4-6 feet with occasional 8 foot sets'},
                {title: 'Gale Warning', desc: 'Sustained winds 25-35 knots expected'},
                {title: 'Marine Weather Statement', desc: 'Thunderstorms possible with gusty winds'}
            ];
            
            var alert = alertTypes[Math.floor(Math.random() * alertTypes.length)];
            updateElement('active-alert-title', alert.title);
            updateElement('active-alert-desc', alert.desc);
        }
        
        // Update mariner notices dynamically
        function updateMarinerNotices() {
            console.log("📋 Updating mariner notices...");
            
            // Add new notice occasionally
            if (Math.random() > 0.7 && activeNotices.length < 4) {
                var newNotices = [
                    {title: 'Harbor Dredging Operations', desc: 'Channel deepening in progress near Pier 8. Expect delays.'},
                    {title: 'Temporary Light Outage', desc: 'Coronado Bridge navigation light out of service.'},
                    {title: 'Military Exercise Area', desc: 'Naval training operations today. Avoid designated areas.'},
                    {title: 'Commercial Diving Operations', desc: 'Underwater work at Harbor Island. Maintain 100ft clearance.'}
                ];
                
                var newNotice = newNotices[Math.floor(Math.random() * newNotices.length)];
                newNotice.id = Date.now();
                newNotice.until = 'Aug ' + (25 + Math.floor(Math.random() * 10)) + ', 2025';
                activeNotices.push(newNotice);
            }
            
            // Remove notice occasionally
            if (Math.random() > 0.8 && activeNotices.length > 1) {
                activeNotices.splice(Math.floor(Math.random() * activeNotices.length), 1);
            }
            
            renderNotices();
        }
        
        // Update vessel traffic dynamically
        function updateVessels() {
            console.log("🚢 Updating vessel traffic...");
            
            // Update existing vessels
            activeVessels.forEach(function(vessel) {
                if (vessel.status === 'Inbound') {
                    var hour = 14 + Math.floor(Math.random() * 6);
                    var min = Math.floor(Math.random() * 60);
                    vessel.detail = 'ETA ' + (hour < 10 ? '0' : '') + hour + (min < 10 ? '0' : '') + min;
                } else if (vessel.status === 'Outbound') {
                    var hour = 10 + Math.floor(Math.random() * 6);
                    var min = Math.floor(Math.random() * 60);
                    vessel.detail = 'Departed ' + (hour < 10 ? '0' : '') + hour + (min < 10 ? '0' : '') + min;
                }
            });
            
            // Change vessel status occasionally
            if (Math.random() > 0.8) {
                var vessel = activeVessels[Math.floor(Math.random() * activeVessels.length)];
                if (vessel.status === 'Inbound') {
                    vessel.status = 'At Berth';
                    var piers = ['Pier 8', 'Pier 11', 'Pier 14', 'Harbor Island'];
                    vessel.detail = piers[Math.floor(Math.random() * piers.length)];
                } else if (vessel.status === 'At Berth' && Math.random() > 0.5) {
                    vessel.status = 'Outbound';
                    var hour = 12 + Math.floor(Math.random() * 6);
                    var min = Math.floor(Math.random() * 60);
                    vessel.detail = 'Departed ' + (hour < 10 ? '0' : '') + hour + (min < 10 ? '0' : '') + min;
                }
            }
            
            // Add new vessel occasionally
            if (Math.random() > 0.8 && activeVessels.length < 5) {
                var newVessels = [
                    {name: 'USS ESSEX (LHD-2)', type: 'Amphibious Assault Ship', status: 'Inbound', priority: 'high'},
                    {name: 'MAERSK COPENHAGEN', type: 'Container Ship', status: 'Inbound', priority: 'medium'},
                    {name: 'CARNIVAL INSPIRATION', type: 'Cruise Ship', status: 'At Berth', priority: 'medium'},
                    {name: 'SCRIPPS RESEARCH', type: 'Research Vessel', status: 'Inbound', priority: 'low'}
                ];
                
                var newVessel = newVessels[Math.floor(Math.random() * newVessels.length)];
                newVessel.id = 'V' + Date.now();
                
                if (newVessel.status === 'Inbound') {
                    var hour = 12 + Math.floor(Math.random() * 8);
                    var min = Math.floor(Math.random() * 60);
                    newVessel.detail = 'ETA ' + (hour < 10 ? '0' : '') + hour + (min < 10 ? '0' : '') + min;
                } else {
                    var piers = ['Pier 8', 'Pier 11', 'Pier 14', 'Harbor Island'];
                    newVessel.detail = piers[Math.floor(Math.random() * piers.length)];
                }
                
                activeVessels.push(newVessel);
            }
            
            renderVessels();
        }
        
        // Helper function to update element with highlighting
        function updateElement(id, value) {
            var el = document.getElementById(id);
            if (el) {
                el.textContent = value;
                el.classList.add('highlight-update');
                setTimeout(function() {
                    el.classList.remove('highlight-update');
                }, 2000);
            }
        }
        
        // Render mariner notices
        function renderNotices() {
            var container = document.getElementById('notices-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            activeNotices.forEach(function(notice) {
                var alertDiv = document.createElement('div');
                alertDiv.className = 'alert-item';
                alertDiv.innerHTML = '<div class="alert-title">' + notice.title + '</div>' +
                                   '<div>' + notice.desc + '</div>' +
                                   '<div class="alert-time">Valid until: ' + notice.until + '</div>';
                container.appendChild(alertDiv);
            });
        }
        
        // Render vessel traffic
        function renderVessels() {
            var container = document.getElementById('traffic-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            activeVessels.forEach(function(vessel) {
                var trafficDiv = document.createElement('div');
                trafficDiv.className = 'traffic-item';
                
                var indicatorColor = '#10b981';
                if (vessel.status === 'Inbound') indicatorColor = '#3b82f6';
                else if (vessel.status === 'Outbound') indicatorColor = '#f59e0b';
                
                trafficDiv.innerHTML = '<div class="vessel-indicator" style="background-color: ' + indicatorColor + ';"></div>' +
                                      '<div class="vessel-info">' +
                                          '<h4>' + vessel.name + '</h4>' +
                                          '<div class="vessel-details">' + vessel.type + ' • ' + vessel.status + ' • ' + vessel.detail + '</div>' +
                                      '</div>';
                container.appendChild(trafficDiv);
            });
        }
        
        // Main update function
        function updateAll() {
            console.log("🔄 METOC system update cycle...");
            
            updateTime();
            
            if (Math.random() > 0.3) updateWeather();
            if (Math.random() > 0.4) updateSeaConditions();
            if (Math.random() > 0.4) updateTides();
            if (Math.random() > 0.5) updateAstronomical();
            if (Math.random() > 0.5) updatePortOps();
            if (Math.random() > 0.5) updateActiveAlerts();
            if (Math.random() > 0.6) updateMarinerNotices();
            if (Math.random() > 0.6) updateVessels();
            
            // Flash status indicator
            var statusDot = document.querySelector('.status-dot');
            if (statusDot) {
                statusDot.style.background = '#3b82f6';
                setTimeout(function() {
                    statusDot.style.background = '#10b981';
                }, 1500);
            }
        }
        
        // Test function
        function testFunctions() {
            console.log("🧪 Testing all systems...");
            
            updateWeather();
            updateSeaConditions();
            updateTides();
            updateAstronomical();
            updatePortOps();
            updateActiveAlerts();
            updateMarinerNotices();
            updateVessels();
            
            console.log("✅ All systems tested successfully!");
        }
        
        // Make testFunctions globally accessible
        window.testFunctions = testFunctions;
        
        // Initialize system
        console.log("📡 Initializing METOC system...");
        
        updateTime();
        setInterval(updateTime, 1000);
        
        // Initial update after 2 seconds
        setTimeout(function() {
            updateAll();
        }, 2000);
        
        // Set up automatic updates every 30 seconds
        setInterval(function() {
            updateAll();
        }, 30000);
        
        console.log("✅ METOC System fully operational!");
    </script>
</body>
</html>
